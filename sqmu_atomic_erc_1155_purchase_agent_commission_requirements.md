# SQMU Atomic ERC-1155 Purchase & Agent Commission â€“ Requirements Table

| Requirement               | Description                                                                                                       | Implementation Detail / Note                                                                         |
| ------------------------- | ----------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------- |
| **Purchase Function**     | Atomic purchase of property tokens with agent attribution and commission payout.                                  | Function: `buySQMU(string propertyCode, uint256 sqmuAmount, address paymentToken, string agentCode)` |
| Property Code             | Unique identifier for each property. Stored and passed as a `string`.                                             | Enables linking to off-chain resources.                                                              |
| Agent Code                | Unique identifier for each agent. Stored and passed as a `string`.                                                | Empty string if no agent is used.                                                                    |
| Payment Token             | Must be globally allowed ERC-20 token.                                                                            | Allowlist managed via admin function.                                                                |
| SQMU Amount               | Quantity of ERC-1155 tokens (with two decimals).                                                                  | Validated as `> 0` before execution.                                                                 |
| Price Calculation         | Price per SQMU set per property.                                                                                  | Used to compute total payment for transaction.                                                       |
| Commission Calculation    | Global commission rate in basis points (bps), applied to total payment.                                           | Admin can set or update.                                                                             |
| Atomic Payment Collection | Entire payment transferred from buyer to contract.                                                                | ERC-20 `transferFrom(msg.sender, address(this), totalPrice)`; nonReentrant.                          |
| Commission Payout         | Contract pays agent commission from received funds.                                                               | Only if agent is valid and commission > 0.                                                           |
| Treasury Payout           | Remainder of payment sent from contract to treasury wallet.                                                       | All within same atomic transaction.                                                                  |
| SQMU Delivery             | ERC-1155 `safeTransferFrom` from treasury to buyer.                                                               | Treasury must `setApprovalForAll` for distributor contract.                                          |
| Sale Event                | Event logs all key data: propertyCode, buyer, paymentToken, amount, agentCode, commission.                        | Uses strings for propertyCode and agentCode for flexibility.                                         |
| Input Validation          | Property exists, is active, allowed payment token, sqmuAmount > 0.                                                | Reverts on any invalid input.                                                                        |
| Security                  | Uses `OwnableUpgradeable` for admin, `ReentrancyGuardUpgradeable` for purchase and fund-moving functions.         | Follows OpenZeppelin best practices.                                                                 |
| UUPS Upgradability        | Contract is upgradeable using the UUPS proxy pattern.                                                             | Includes `_authorizeUpgrade(address)` restricted to owner.                                           |
| Admin Functions           | Register property, register agent, set global commission, set property status, allow/remove global payment token. | Only owner can execute.                                                                              |
| Utility Functions         | Get property info, agent info, check token allowlist, get price for amount, check property status.                | Read-only; enables front-end integration.                                                            |
| Manual/Admin Backstop     | Admin can manually distribute tokens and commission for off-chain/correction cases.                               | Protected with `nonReentrant`; maintains full control and recovery options. |
| Event Logging             | Sale, property/agent registration, payment token list changes, commission changes, manual distributions.          | Ensures auditability and transparency.                                                               |

**Note:** All string-based codes (propertyCode, agentCode) are stored and passed as strings for future compatibility and external system integration. The contract is designed for upgradeability and maximum flexibility
