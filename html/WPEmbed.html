<!-- Standalone mint widget for WordPress -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SQMU Widget</title>
  <!-- Load ethers.js and MetaMask SDK from pinned CDN versions -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script src="https://c0f4f41c-2f55-4863-921b-sdk-docs.github.io/cdn/metamask-sdk.js"></script>
</head>
<body>
  <h1>SQMU Mint Widget</h1>
  <button id="connect">Connect Wallet</button>
  <button id="disconnect">Disconnect</button>
  <label>Token ID <input id="token-id" type="text"></label>
  <label>Amount <input id="token-amount" type="number" value="1"></label>
  <label>URI <input id="token-uri" type="text" value="0x"></label>
  <button id="mint">Mint</button>
  <div id="mint-status"></div>
  <label>Address <input id="wallet-address" type="text" placeholder="optional"></label>
  <button id="check-balance">Check Balance</button>
  <div id="balance-status"></div>
  <label>Recipient <input id="recipient" type="text"></label>
  <label>Data <input id="transfer-data" type="text" value="0x"></label>
  <button id="transfer">Transfer</button>
  <div id="transfer-status"></div>
  <script>
    // Standalone mint widget with embedded ABI for WordPress use.
    // Connection status updates appear in the #mint-status div.
    // Modular widgets load connectWallet() from wallet.js instead.
    const MMSDK = new MetaMaskSDK.MetaMaskSDK({
      dappMetadata: { name: 'SQMU Mint Widget', url: window.location.href },
      infuraAPIKey: '822e08935dea4fb48f668ff353ac863a',
    });
    let provider;
    let signer;
    let contract;

    const sqmuAbi = {"name":"SQMU","address":"0xd0b895e975f24045e43d788d42BD938b78666EC8","abi":[{"inputs":[],"stateMutability":"nonpayable","type":"constructor"},{"inputs":[{"internalType":"address","name":"target","type":"address"}],"name":"AddressEmptyCode","type":"error"},{"inputs":[{"internalType":"address","name":"account","type":"address"},{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"uint256","name":"value","type":"uint256"}],"name":"burn","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"account","type":"address"},{"internalType":"uint256[]","name":"ids","type":"uint256[]"},{"internalType":"uint256[]","name":"values","type":"uint256[]"}],"name":"burnBatch","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"sender","type":"address"},{"internalType":"uint256","name":"balance","type":"uint256"},{"internalType":"uint256","name":"needed","type":"uint256"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"ERC1155InsufficientBalance","type":"error"},{"inputs":[{"internalType":"address","name":"approver","type":"address"}],"name":"ERC1155InvalidApprover","type":"error"},{"inputs":[{"internalType":"uint256","name":"idsLength","type":"uint256"},{"internalType":"uint256","name":"valuesLength","type":"uint256"}],"name":"ERC1155InvalidArrayLength","type":"error"},{"inputs":[{"internalType":"address","name":"operator","type":"address"}],"name":"ERC1155InvalidOperator","type":"error"},{"inputs":[{"internalType":"address","name":"receiver","type":"address"}],"name":"ERC1155InvalidReceiver","type":"error"},{"inputs":[{"internalType":"address","name":"sender","type":"address"}],"name":"ERC1155InvalidSender","type":"error"},{"inputs":[{"internalType":"address","name":"operator","type":"address"},{"internalType":"address","name":"owner","type":"address"}],"name":"ERC1155MissingApprovalForAll","type":"error"},{"inputs":[{"internalType":"address","name":"implementation","type":"address"}],"name":"ERC1967InvalidImplementation","type":"error"},{"inputs":[],"name":"ERC1967NonPayable","type":"error"},{"inputs":[],"name":"FailedCall","type":"error"},{"inputs":[{"internalType":"string","name":"uri_","type":"string"},{"internalType":"string","name":"name_","type":"string"},{"internalType":"string","name":"symbol_","type":"string"},{"internalType":"address","name":"initialOwner","type":"address"}],"name":"initialize","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"InvalidInitialization","type":"error"},{"inputs":[{"internalType":"address","name":"account","type":"address"},{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"bytes","name":"data","type":"bytes"}],"name":"mint","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256[]","name":"ids","type":"uint256[]"},{"internalType":"uint256[]","name":"amounts","type":"uint256[]"},{"internalType":"bytes","name":"data","type":"bytes"}],"name":"mintBatch","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"NotInitializing","type":"error"},{"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"OwnableInvalidOwner","type":"error"},{"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"OwnableUnauthorizedAccount","type":"error"},{"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"newImplementation","type":"address"},{"internalType":"bytes","name":"data","type":"bytes"}],"name":"upgradeToAndCall","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[],"name":"UUPSUnauthorizedCallContext","type":"error"},{"inputs":[{"internalType":"bytes32","name":"slot","type":"bytes32"}],"name":"UUPSUnsupportedProxiableUUID","type":"error"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"account","type":"address"},{"indexed":true,"internalType":"address","name":"operator","type":"address"},{"indexed":false,"internalType":"bool","name":"approved","type":"bool"}],"name":"ApprovalForAll","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint64","name":"version","type":"uint64"}],"name":"Initialized","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"inputs":[],"name":"renounceOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256[]","name":"ids","type":"uint256[]"},{"internalType":"uint256[]","name":"values","type":"uint256[]"},{"internalType":"bytes","name":"data","type":"bytes"}],"name":"safeBatchTransferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"uint256","name":"value","type":"uint256"},{"internalType":"bytes","name":"data","type":"bytes"}],"name":"safeTransferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"operator","type":"address"},{"internalType":"bool","name":"approved","type":"bool"}],"name":"setApprovalForAll","outputs":[],"stateMutability":"nonpayable","type":"function"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"operator","type":"address"},{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":false,"internalType":"uint256[]","name":"ids","type":"uint256[]"},{"indexed":false,"internalType":"uint256[]","name":"values","type":"uint256[]"}],"name":"TransferBatch","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"operator","type":"address"},{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":false,"internalType":"uint256","name":"id","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"TransferSingle","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"string","name":"value","type":"string"},{"indexed":true,"internalType":"uint256","name":"id","type":"uint256"}],"name":"URI","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"implementation","type":"address"}],"name":"Upgraded","type":"event"},{"inputs":[{"internalType":"address","name":"account","type":"address"},{"internalType":"uint256","name":"id","type":"uint256"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address[]","name":"accounts","type":"address[]"},{"internalType":"uint256[]","name":"ids","type":"uint256[]"}],"name":"balanceOfBatch","outputs":[{"internalType":"uint256[]","name":"","type":"uint256[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"account","type":"address"},{"internalType":"address","name":"operator","type":"address"}],"name":"isApprovedForAll","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"proxiableUUID","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes4","name":"interfaceId","type":"bytes4"}],"name":"supportsInterface","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"symbol","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"UPGRADE_INTERFACE_VERSION","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"uri","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"}],"filePath":"SQMU-Scroll/SQMU.sol","pinnedAt":1752506978200};
    // Deployed proxy address. Update this value when redeploying the contract.
    const contractAddress = '0xd0b895e975f24045e43d788d42BD938b78666EC8';

    // Connect the user's wallet via MetaMask SDK
    const SCROLL_CHAIN_ID = '0x82750';
    async function connect() {
        const ethereum = MMSDK.getProvider();
        const statusDiv = document.getElementById('mint-status');
        statusDiv.innerText = 'Connecting to MetaMask...';

        try {
          const permissions = await ethereum.request({
            method: 'wallet_requestPermissions',
            params: [{ eth_accounts: {} }],
          });
          const accountsPermission = permissions.find(
            (p) => p.parentCapability === 'eth_accounts'
          );
          if (!accountsPermission) {
            throw new Error('eth_accounts permission not granted');
          }
          await ethereum.request({ method: 'eth_requestAccounts', params: [] });

          let chainId = await ethereum.request({ method: 'eth_chainId', params: [] });
          if (chainId !== SCROLL_CHAIN_ID) {
            await ethereum.request({
              method: 'wallet_switchEthereumChain',
              params: [{ chainId: SCROLL_CHAIN_ID }],
            });
            chainId = await ethereum.request({ method: 'eth_chainId', params: [] });
          }

          provider = new ethers.providers.Web3Provider(ethereum);
          signer = provider.getSigner();

          // Create a contract instance using the embedded ABI
          contract = new ethers.Contract(contractAddress, sqmuAbi.abi, signer);

        statusDiv.innerHTML = '<span style="color:green;">Connected to Scroll. Contract ready!</span>';

        // Enable actions once the contract is ready
        document.getElementById('mint').addEventListener('click', mintToken);
        document.getElementById('check-balance').addEventListener('click', checkBalance);
        document.getElementById('transfer').addEventListener('click', transferToken);
        document.getElementById('disconnect').addEventListener('click', disconnect);
        } catch (err) {
          statusDiv.innerHTML = `<span style="color:red;">${err.message}</span>`;
        }
      }

      // Mint tokens using owner account
  async function mintToken() {
    const statusDiv = document.getElementById('mint-status');
          const tokenId = document.getElementById('token-id').value;
          const amount = document.getElementById('token-amount').value;
          const uriData = document.getElementById('token-uri').value || '0x';

        if (!contract) {
          statusDiv.innerHTML = '<span style="color:red;">Connect wallet first.</span>';
          return;
        }

        try {
          const account = await signer.getAddress();
          const tx = await contract.mint(account, tokenId, amount, uriData);
          statusDiv.innerText = 'Minting...';
          await tx.wait();
          statusDiv.innerHTML = `<span style="color:green;">Minted token ${tokenId} x ${amount}</span>`;
        } catch (err) {
          statusDiv.innerHTML = `<span style="color:red;">${err.message}</span>`;
    }
  }

  // Check an address balance for a token ID
  async function checkBalance() {
    const statusDiv = document.getElementById('balance-status');
    const tokenId = document.getElementById('token-id').value;
    let addr = document.getElementById('wallet-address').value;

    if (!contract) {
      statusDiv.innerHTML = '<span style="color:red;">Connect wallet first.</span>';
      return;
    }

    try {
      if (!addr) {
        addr = await signer.getAddress();
      }
      const bal = await contract.balanceOf(addr, tokenId);
      statusDiv.innerHTML = `<span style="color:green;">Balance: ${bal.toString()}</span>`;
    } catch (err) {
      statusDiv.innerHTML = `<span style="color:red;">${err.message}</span>`;
    }
  }

  // Transfer tokens to another address
  async function transferToken() {
    const statusDiv = document.getElementById('transfer-status');
    const tokenId = document.getElementById('token-id').value;
    const amount = document.getElementById('token-amount').value;
    const to = document.getElementById('recipient').value;
    const data = document.getElementById('transfer-data').value || '0x';

    if (!contract) {
      statusDiv.innerHTML = '<span style="color:red;">Connect wallet first.</span>';
      return;
    }

    try {
      const from = await signer.getAddress();
      const tx = await contract.safeTransferFrom(from, to, tokenId, amount, data);
      statusDiv.innerText = 'Transferring...';
      await tx.wait();
      statusDiv.innerHTML = '<span style="color:green;">Transfer complete</span>';
    } catch (err) {
      statusDiv.innerHTML = `<span style="color:red;">${err.message}</span>`;
    }
  }

  async function disconnect() {
    const ethereum = MMSDK.getProvider();
    const statusDiv = document.getElementById('mint-status');
    try {
      await ethereum.request({
        method: 'wallet_revokePermissions',
        params: [{ eth_accounts: {} }],
      });
      provider = undefined;
      signer = undefined;
      contract = undefined;
      statusDiv.innerHTML = '<span style="color:orange;">Disconnected</span>';
    } catch (err) {
      statusDiv.innerHTML = `<span style="color:red;">${err.message}</span>`;
    }
  }

    // Bind connect button
    document.getElementById('connect').addEventListener('click', connect);
    document.getElementById('disconnect').addEventListener('click', disconnect);
  </script>
</body>
</html>
