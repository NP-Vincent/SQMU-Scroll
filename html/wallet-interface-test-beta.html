<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Wallet Test UI</title>

  <!-- CDN Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5/dist/ethers.umd.min.js"></script>
  <script src="https://unpkg.com/@metamask/sdk/dist/metamask-sdk.umd.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@web3auth/modal@8/dist/modal.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@web3auth/metamask-adapter@8/dist/metamaskAdapter.umd.min.js"></script>

  <!-- IMPORTANT: wallet-beta.js exports functions, so load it as a module -->
  <script type="module">
    import { connectWallet, disconnectWallet } from 'https://np-vincent.github.io/SQMU-Scroll/js/wallet-beta.js';

    const disconnectBtn = document.getElementById('disconnectBtn');
    const statusDivId   = 'statusDiv';
    let session = null; // { provider, signer, source }

    document.getElementById('mmConnect').addEventListener('click', async () => {
      try {
        session = await connectWallet(statusDivId);                 // MetaMask path
        disconnectBtn.dataset.source = session.source;              // 'metamask'
        disconnectBtn.disabled = false;
      } catch (e) {
        console.error(e);
      }
    });

    document.getElementById('web3AuthConnect').addEventListener('click', async () => {
      try {
        session = await connectWallet(statusDivId, 'web3auth');     // Web3Auth path
        disconnectBtn.dataset.source = session.source;              // 'web3auth' | 'web3auth-adapter'
        disconnectBtn.disabled = false;
      } catch (e) {
        console.error(e);
      }
    });

    disconnectBtn.addEventListener('click', async () => {
      try {
        await disconnectWallet(statusDivId, disconnectBtn.dataset.source);
      } finally {
        session = null;
        disconnectBtn.disabled = true;
      }
    });

    // Minimal balance checker (ETH on Scroll for any address/contract)
    document.getElementById('checkBalance').addEventListener('click', async () => {
      const out = document.getElementById('contractStatus');
      const addr = document.getElementById('contractAddr').value.trim();
      if (!addr) return (out.textContent = 'Enter an address.');
      if (!session?.provider) return (out.textContent = 'Connect first.');

      try {
        const code = await session.provider.getCode(addr);
        const kind = code && code !== '0x' ? 'Contract' : 'EOA';
        const wei  = await session.provider.getBalance(addr);
        const eth  = ethers.utils.formatEther(wei);
        out.textContent = `${kind} balance: ${eth} ETH`;
      } catch (e) {
        out.textContent = `Error: ${e.message}`;
      }
    });
  </script>
</head>

<body>
  <h2>Wallet Test Interface</h2>

  <button id="mmConnect">Connect MetaMask</button>
  <button id="web3AuthConnect">Sign in with Social</button>
  <button id="disconnectBtn" disabled>Disconnect</button>

  <pre id="statusDiv">Disconnected</pre>

  <hr />

  <h3>Check Contract / Account Balance</h3>
  <input id="contractAddr" placeholder="0x..." size="45" />
  <button id="checkBalance">Check Balance</button>
  <pre id="contractStatus"></pre>
</body>
</html>
